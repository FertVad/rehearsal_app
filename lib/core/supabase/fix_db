# üîç –ê–Ω–∞–ª–∏–∑ Supabase —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ö–æ—Ä–æ—à–æ:

1. **BaseSupabaseRepository —Å–æ–∑–¥–∞–Ω** –∏ —á–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
2. **–°—Ö–µ–º—ã –ë–î —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç** - –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ –ø–æ–ª–µ–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ timestamps —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ** –≤ ProfilesRepository
4. **Foreign keys –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** - `profile_id` –≤–º–µ—Å—Ç–æ `user_id`

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### ‚ùå 1. –ù–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ BaseRepository

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–æ–ª—å–∫–æ ProfilesRepository –Ω–∞—Å–ª–µ–¥—É–µ—Ç –æ—Ç BaseSupabaseRepository

```dart
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (ProfilesRepository):
class SupabaseProfilesRepository extends BaseSupabaseRepository

// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–æ—Å—Ç–∞–ª—å–Ω—ã–µ):
class SupabaseAvailabilityRepository implements AvailabilityRepository
class SupabaseRehearsalsRepository implements RehearsalsRepository  
class SupabaseProjectsRepository extends BaseSupabaseRepository // –Ω–∞—Å–ª–µ–¥—É–µ—Ç –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–æ–¥—ã
```

**–†–µ—à–µ–Ω–∏–µ:** –í—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BaseRepository

### ‚ùå 2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ timestamp –≤ 3 –∏–∑ 4 —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

```dart
// –ü–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –≤ AvailabilityRepository, RehearsalsRepository, ProjectsRepository:
final createdAt = DateTime.parse(response['created_at']);
final updatedAt = DateTime.parse(response['updated_at']);
final deletedAt = response['deleted_at'] != null ? DateTime.parse(response['deleted_at']) : null;

// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–µ–∑–¥–µ:
final timestamps = extractTimestamps(response);
```

### ‚ùå 3. –ú–µ—Ä—Ç–≤—ã–π/–Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ –≤ BaseRepository

```dart
// –ù–∏–∫—Ç–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:
T excludeDeleted<T>(T query) // –ú–µ—Ç–æ–¥ –±–µ—Å–ø–æ–ª–µ–∑–µ–Ω –±–µ–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
String? generateId() // –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç null
bool shouldIncludeField(dynamic value) // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
```

### ‚ùå 4. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ ProjectsRepository.listForUser()

```dart
// ‚ùå –°–õ–û–ú–ê–ù–ù–´–ô –ö–û–î:
.eq('owner_id', userId) // owner_id –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ –≤ —Å—Ö–µ–º–µ –ë–î!

// ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
.eq('director_id', userId) // –∏–ª–∏ —á–µ—Ä–µ–∑ project_members
```

### ‚ùå 5. –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏ –≤ models.dart

```dart
// –≠—Ç–∏ –º–æ–¥–µ–ª–∏ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∏–≥–¥–µ:
class SupabaseProfile        // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
class SupabaseRehearsal      // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è  
class SupabaseUserAvailability // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
class SupabaseProject        // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

## üîß –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –≠—Ç–∞–ø 1: –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

#### 1.1 SupabaseAvailabilityRepository
```dart
// –î–û–ë–ê–í–ò–¢–¨:
class SupabaseAvailabilityRepository extends BaseSupabaseRepository implements AvailabilityRepository {

// –ó–ê–ú–ï–ù–ò–¢–¨ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–π—Å—è –∫–æ–¥:
final timestamps = extractTimestamps(response);
return Availability(
  // ...
  createdAtUtc: timestamps['createdAtUtc']!,
  updatedAtUtc: timestamps['updatedAtUtc']!,
  deletedAtUtc: timestamps['deletedAtUtc'],
);

// –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ safeExecute –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤
```

#### 1.2 SupabaseRehearsalsRepository
```dart
// –î–û–ë–ê–í–ò–¢–¨:
class SupabaseRehearsalsRepository extends BaseSupabaseRepository implements RehearsalsRepository {

// –ó–ê–ú–ï–ù–ò–¢–¨ –≤ create():
return safeExecute(() async {
  // –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è
}, operationName: 'CREATE', tableName: _tableName);

// –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ performSoftDelete:
await performSoftDelete(_tableName, id);
```

#### 1.3 SupabaseProjectsRepository
```dart
// –ò–°–ü–†–ê–í–ò–¢–¨ –ö–†–ò–¢–ò–ß–ï–°–ö–£–Æ –û–®–ò–ë–ö–£:
@override
Future<List<Project>> listForUser(String userId) async {
  // ‚ùå –£–î–ê–õ–ò–¢–¨:
  // .eq('owner_id', userId)
  
  // ‚úÖ –î–û–ë–ê–í–ò–¢–¨:
  .eq('director_id', userId)
  // –ò–õ–ò —á–µ—Ä–µ–∑ project_members –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
}

// –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨ –º–µ—Ç–æ–¥—ã BaseRepository:
final timestamps = extractTimestamps(data); // –≤–º–µ—Å—Ç–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –≠—Ç–∞–ø 2: –û—á–∏—Å—Ç–∏—Ç—å –º–µ—Ä—Ç–≤—ã–π –∫–æ–¥

#### 2.1 –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏
```dart
// –£–î–ê–õ–ò–¢–¨ –ò–ó models.dart:
class SupabaseProfile { ... }        // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
class SupabaseRehearsal { ... }      // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
class SupabaseUserAvailability { ... } // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è  
class SupabaseProject { ... }        // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

#### 2.2 –£–ø—Ä–æ—Å—Ç–∏—Ç—å BaseRepository
```dart
// –£–î–ê–õ–ò–¢–¨ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã:
T excludeDeleted<T>(T query) // –ë–µ—Å–ø–æ–ª–µ–∑–µ–Ω
String? generateId() // –ù–µ –Ω—É–∂–µ–Ω
bool shouldIncludeField(dynamic value) // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

// –û–°–¢–ê–í–ò–¢–¨ —Ç–æ–ª—å–∫–æ:
Map<String, int?> extractTimestamps()
Future<void> performSoftDelete()
Future<T> safeExecute()
String getCurrentTimestamp()
```

### –≠—Ç–∞–ø 3: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 3.1 –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â—É—é —Ç–∞–±–ª–∏—Ü—É project_members
```dart
// –°–æ–∑–¥–∞—Ç—å SupabaseProjectMembersRepository –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –ª–æ–≥–∏–∫–∞ —á–ª–µ–Ω—Å—Ç–≤–∞
class SupabaseProjectMembersRepository extends BaseSupabaseRepository {
  Future<void> addMember(String projectId, String profileId, String role);
  Future<void> removeMember(String projectId, String profileId);
  Future<List<ProjectMember>> listMembers(String projectId);
}
```

#### 3.2 –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã –≤ RehearsalParticipants
```dart
// –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ —Ä–µ–ø–µ—Ç–∏—Ü–∏–π
class SupabaseRehearsalParticipantsRepository extends BaseSupabaseRepository {
  Future<void> addParticipant(String rehearsalId, String profileId);
  Future<void> updateRSVP(String rehearsalId, String profileId, String rsvp);
}
```

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–†–û–ë–õ–ï–ú

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞:
- ‚ö†Ô∏è **extractTimestamps –ª–æ–≥–∏–∫–∞**: –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 3 —Ä–∞–∑–∞
- ‚ö†Ô∏è **Error handling**: —Ä–∞–∑–Ω—ã–π –≤ –∫–∞–∂–¥–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- ‚ö†Ô∏è **DateTime parsing**: –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤–µ–∑–¥–µ

### –ú–µ—Ä—Ç–≤—ã–π –∫–æ–¥:
- üóëÔ∏è **models.dart**: 200+ —Å—Ç—Ä–æ–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π
- üóëÔ∏è **BaseRepository**: 3 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–µ—Ç–æ–¥–∞
- üóëÔ∏è **hardcoded –ª–æ–≥–∏–∫–∞**: –≤ _generateInviteCode()

### –°–ª–æ–º–∞–Ω–Ω—ã–π –∫–æ–¥:
- üí• **ProjectsRepository.listForUser()**: –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- üí• **Date parsing**: –≤ ProjectsRepository –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç DATE

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### üî¥ –ö–†–ò–¢–ò–ß–ù–û (—Å–ª–æ–º–∞–Ω–æ):
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å `listForUser()` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `director_id`
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å DATE parsing –≤ ProjectsRepository

### üü° –í–ê–ñ–ù–û (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥):
1. –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ BaseRepository
2. –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏
3. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ repository –¥–ª—è —Å–≤—è–∑—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü

### üü¢ –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è):
1. –£–ø—Ä–æ—Å—Ç–∏—Ç—å BaseRepository
2. –î–æ–±–∞–≤–∏—Ç—å –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é
3. –£–ª—É—á—à–∏—Ç—å error handling

## üí° –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –î–ï–ô–°–¢–í–ò–Ø

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å** –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ ProjectsRepository
2. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å** –≤—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ BaseRepository  
3. **–£–¥–∞–ª–∏—Ç—å** –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥–µ–ª–∏
4. **–î–æ–±–∞–≤–∏—Ç—å** –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–≤—è–∑—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–†–µ–∑—É–ª—å—Ç–∞—Ç: —á–∏—Å—Ç—ã–π, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π –∫–æ–¥ –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–µ—Ä—Ç–≤—ã—Ö —É—á–∞—Å—Ç–∫–æ–≤.