# üéØ –ó–ê–î–ê–ß–ê: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ Supabase —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ –ë–î

## üìã –ö–û–ù–¢–ï–ö–°–¢ –ü–†–û–ï–ö–¢–ê

Rehearsal App - Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–ø–µ—Ç–∏—Ü–∏—è–º–∏ —Ç–µ–∞—Ç—Ä–∞–ª—å–Ω—ã—Ö —Ç—Ä—É–ø–ø.
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Clean Architecture —Å Supabase –∫–∞–∫ backend.

**–ü–†–û–ë–õ–ï–ú–ê:** Supabase —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ –ë–î, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–∞–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

## üóÑÔ∏è –°–•–ï–ú–´ –¢–ê–ë–õ–ò–¶ (GROUND TRUTH)

### üìä availabilities
```
id             | uuid
created_at     | timestamp with time zone  
updated_at     | timestamp with time zone
deleted_at     | timestamp with time zone
user_id        | uuid
date_utc       | bigint
status         | text
intervals_json | text  
note           | text
```

### üë• profiles  
```
id           | uuid
user_id      | uuid (—Å—Å—ã–ª–∫–∞ –Ω–∞ auth.users)
display_name | text
avatar_url   | text
timezone     | text
bio          | text
phone        | text
metadata     | jsonb
created_at   | timestamp with time zone
updated_at   | timestamp with time zone
deleted_at   | timestamp with time zone
```

### üé≠ rehearsals
```
id           | uuid
project_id   | uuid
title        | text
description  | text
location     | text
start_time   | timestamp with time zone
end_time     | timestamp with time zone
is_mandatory | boolean
created_by   | uuid
metadata     | jsonb
created_at   | timestamp with time zone
updated_at   | timestamp with time zone
deleted_at   | timestamp with time zone
```

### üé™ rehearsal_participants
```
id            | uuid
rehearsal_id  | uuid ‚Üí rehearsals(id)
profile_id    | uuid ‚Üí profiles(id)
rsvp          | USER-DEFINED (enum)
response_time | timestamp with time zone
notes         | text
metadata      | jsonb
created_at    | timestamp with time zone
updated_at    | timestamp with time zone
deleted_at    | timestamp with time zone
```

### üìä project_members
```
id         | uuid
project_id | uuid ‚Üí projects(id) 
profile_id | uuid ‚Üí profiles(id)
role       | USER-DEFINED (enum)
joined_at  | timestamp with time zone
is_active  | boolean
metadata   | jsonb
created_at | timestamp with time zone
updated_at | timestamp with time zone
deleted_at | timestamp with time zone
```

### üé® projects
```
id          | uuid
name        | text
description | text
start_date  | date
end_date    | date
venue       | text
director_id | uuid
invite_code | text
is_active   | boolean
metadata    | jsonb
created_at  | timestamp with time zone
updated_at  | timestamp with time zone
deleted_at  | timestamp with time zone
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- `start_date`, `end_date` - —Ç–∏–ø `date` (–Ω–µ timestamp!)
- `director_id` - —Å—Å—ã–ª–∫–∞ –Ω–∞ profiles(id)
- `invite_code` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- `is_active` - —Ñ–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –í –ö–û–î–ï

### ‚ùå SupabaseAvailabilityRepository
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:** `'availability'` ‚Üí –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `'availabilities'`
2. **–°–º–µ—à–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç:** 
   - –í `getForUserOnDateUtc()`: –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ ISO string
   - –í `upsertForUserOnDateUtc()`: –ø–µ—Ä–µ–¥–∞–µ—Ç int 
   - –í `listForUserRange()`: –æ–∂–∏–¥–∞–µ—Ç int –≤ –ë–î
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è:** 
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `date_utc` vs `date` –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –≤–µ–∑–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `date_utc` (bigint)

### ‚ùå SupabaseRehearsalsRepository  
1. **–ü–æ–ª—è location vs venue:** –∫–æ–¥ —Å–º–µ—à–∏–≤–∞–µ—Ç —ç—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏—è
2. **Foreign key:** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `profile_id` –≤ rehearsal_participants, –Ω–µ `user_id`
3. **Queries —Å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏:** —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è

### ‚ùå SupabaseProfilesRepository
1. **–ü—É—Ç–∞–Ω–∏—Ü–∞ —Å –ø–æ–ª—è–º–∏:** –µ—Å—Ç—å –∏ `id` –∏ `user_id` - –Ω—É–∂–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è:** –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `timezone`, `phone` –∏–∑ —Å—Ö–µ–º—ã
3. **Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è:** `tz: 'UTC'` –≤–º–µ—Å—Ç–æ —á—Ç–µ–Ω–∏—è –∏–∑ –ë–î

### ‚ùå –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞:** –∫–∞–∂–¥—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ª–æ–≥–∏–∫—É –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –¥–∞—Ç
2. **Inconsistent naming:** –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É –≤ –∫–æ–¥–µ –∏ –ë–î  
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ BaseRepository:** –Ω–µ—Ç –æ–±—â–µ–π –±–∞–∑—ã –¥–ª—è shared –ª–æ–≥–∏–∫–∏

## ‚úÖ –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞—Ç—å BaseSupabaseRepository
```dart
// lib/core/supabase/base_repository.dart
abstract class BaseSupabaseRepository {
  // –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ timestamps  
  Map<String, int> extractTimestamps(Map<String, dynamic> response);
  
  // –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ soft delete
  Future<void> performSoftDelete(String tableName, String id);
  
  // –û–±—â–∞—è –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ deleted_at
  // Utility –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏
}
```

### –≠—Ç–∞–ø 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∂–¥—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
1. **–ù–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –æ—Ç BaseSupabaseRepository**
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü –∏ –ø–æ–ª–µ–π**
3. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç—ã –¥–∞—Ç**
4. **–î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è**
5. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å foreign key references**

### –≠—Ç–∞–ø 3: –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª–∏ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–æ–¥–µ–ª–µ–π –≤ `lib/core/supabase/models.dart` —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ.

## üî• –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –õ–æ–≥–∏–∫–∞ –≤–ª–∞–¥–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞–º–∏
**–ü–†–û–ë–õ–ï–ú–ê:** –ö–æ–¥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ `owner_id` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –ø—Ä–æ–µ–∫—Ç–∞.

**–†–ï–®–ï–ù–ò–ï:** 
- –í–ª–∞–¥–µ–ª–µ—Ü –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `director_id` (–ø—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞)
- –ò–õ–ò —á–µ—Ä–µ–∑ —Ç–∞–±–ª–∏—Ü—É `project_members` —Å —Ä–æ–ª—å—é 'admin'/'director'
- –ú–µ—Ç–æ–¥ `listForUser()` –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ JOIN —Å `project_members`

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ queries
```sql
-- –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Ç–µ–∫—É—â–∏–π –∫–æ–¥):
SELECT * FROM projects WHERE owner_id = ?

-- –ü–†–ê–í–ò–õ–¨–ù–û (–Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å):
SELECT p.* FROM projects p 
JOIN project_members pm ON p.id = pm.project_id 
WHERE pm.profile_id = ? AND pm.is_active = true

-- –ò–õ–ò –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤:
SELECT * FROM projects WHERE director_id = ?
```

### 1. SupabaseAvailabilityRepository
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã: `'availabilities'`
- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å `date_utc` –∫–∞–∫ bigint –≤–µ–∑–¥–µ  
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å `user_id` references
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ BaseRepository

### 2. SupabaseRehearsalsRepository  
- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `location` (–Ω–µ `venue`)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å foreign key: `profile_id` –≤ rehearsal_participants
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è `created_by`, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ `metadata`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ BaseRepository

### 3. SupabaseProfilesRepository
- [ ] –ü—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `id` vs `user_id` 
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `timezone`, `phone`, `bio`
- [ ] –£–±—Ä–∞—Ç—å hardcoded –∑–Ω–∞—á–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ BaseRepository

### 4. SupabaseProjectsRepository (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ö–µ–º—ã)
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ projects
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑–∏ —Å project_members
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤ BaseRepository

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
1. **–ö–æ–º–ø–∏–ª—è—Ü–∏—è:** `flutter analyze`
2. **Unit —Ç–µ—Å—Ç—ã:** –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã
3. **Integration —Ç–µ—Å—Ç—ã:** –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

## üìù CHECKLIST –í–´–ü–û–õ–ù–ï–ù–ò–Ø

- [ ] –°–æ–∑–¥–∞–Ω BaseSupabaseRepository
- [ ] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω AvailabilityRepository  
- [ ] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω RehearsalsRepository
- [ ] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω ProfilesRepository
- [ ] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω ProjectsRepository
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã —Å–≤—è–∑—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã (project_members, rehearsal_participants)
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

## üé™ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

1. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å Domain layer
2. **–ù–µ –∏–∑–º–µ–Ω—è—Ç—å public API** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
3. **–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –∫ –Ω–æ–≤—ã–º –º–µ—Ç–æ–¥–∞–º
4. **–°–ª–µ–¥–æ–≤–∞—Ç—å Dart conventions** –¥–ª—è naming
5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ç–∏–ø—ã** (UUID, DateTime, etc.)

---

**–í–ê–ñ–ù–û:** –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. 
–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã!